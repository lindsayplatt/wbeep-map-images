
include:
  - 1_fetch.yml

packages:
  - sf
  - geojsonio
  - readr
  - dplyr
  - purrr

sources:
  - 2_process/src/process_hru_sf.R
  - 2_process/src/process_model_output.R

targets:
  all: 
    depends: 
      - 2_process/out/hru_sf.rds
      - 2_process/out/hru_conus_sf.rds
      - 2_process/out/wbeep_storage_data_combined.rds

  ##### Process spatial data ##### 
  
  2_process/out/hru_sf.rds:
    command: topo_to_sf(
      target_name = target_name,
      topo_fn = '1_fetch/out/hru.topojson', 
      proj_start = I(4326),
      proj_target = proj)

  # Crop hru spatial data to just CONUS
  2_process/out/hru_conus_sf.rds:
    command: crop_hru_to_conus(
      target_name = target_name,
      hru_sf_fn = '2_process/out/hru_sf.rds', 
      conus_sf_fn = '1_fetch/out/conus_sf.rds')

  ##### Process WBEEP storage modeled data for mapping #####

  2_process/out/wbeep_storage_data_combined.rds:
    command: process_and_combine_model_output(target_name, "1_fetch/log/1_fetch_wbeep_storage_date_tasks.ind")
